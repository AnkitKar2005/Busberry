<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results - BusBerry</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Urbanist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="light-mode">
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../index.html" class="logo">
                    <span class="logo-icon">ðŸšŒ</span>
                    <span class="logo-text">BusBerry</span>
                </a>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html" class="nav-link">Home</a></li>
                <li><a href="login.html" class="nav-link">Login</a></li>
            </ul>
        </div>
    </nav>

    <div class="container" style="margin-top: 100px; padding: var(--spacing-lg);">
        <h1>Search Results</h1>
        <div id="searchInfo" style="margin-bottom: var(--spacing-lg);"></div>
        <div id="resultsContainer" class="routes-grid">
            <div class="spinner" style="margin: 0 auto;"></div>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        async function loadSearchResults() {
            const params = new URLSearchParams(window.location.search);
            const from = params.get('from');
            const to = params.get('to');
            const date = params.get('date');
            const passengers = params.get('passengers') || '1';

            document.getElementById('searchInfo').innerHTML = `
                <p><strong>From:</strong> ${from} | <strong>To:</strong> ${to} | <strong>Date:</strong> ${date} | <strong>Passengers:</strong> ${passengers}</p>
            `;

            try {
                const results = await apiRequest('/search/buses', {
                    method: 'POST',
                    body: JSON.stringify({
                        from: from,
                        to: to,
                        date: date,
                        passengers: parseInt(passengers)
                    })
                });

                displayResults(results);
            } catch (error) {
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="empty-state">
                        <p>Error loading results. Please try again.</p>
                    </div>
                `;
            }
        }

        function displayResults(results) {
            const container = document.getElementById('resultsContainer');
            if (results.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No buses found for this route.</p></div>';
                return;
            }

            container.innerHTML = results.map(bus => `
                <div class="card">
                    <div class="card-header">
                        <h3>${bus.busName}</h3>
                        <span class="badge badge-primary">${bus.availableSeats} seats</span>
                    </div>
                    <div class="card-body">
                        <p><i class="fas fa-clock"></i> ${bus.departureTime} - ${bus.arrivalTime}</p>
                        <p><i class="fas fa-hourglass-half"></i> ${bus.duration}</p>
                        <p><i class="fas fa-star"></i> ${bus.rating} / 5.0</p>
                        <p><strong>Operator:</strong> ${bus.operatorName}</p>
                        <p class="stat-number" style="font-size: 1.5rem; margin-top: 0.5rem;">
                            ${formatCurrency(bus.price)}
                        </p>
                    </div>
                    <div class="card-footer">
                        <button class="btn-primary" onclick="bookBus('${bus.busId}', '${bus.routeId}')">
                            Book Now
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function bookBus(busId, routeId) {
            const user = storage.get(CONFIG.STORAGE.USER);
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            window.location.href = `booking.html?busId=${busId}&routeId=${routeId}`;
        }

        loadSearchResults();
    </script>
</body>
</html>

